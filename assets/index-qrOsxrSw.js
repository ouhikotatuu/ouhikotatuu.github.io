import{u as G,e as h}from"./exportToExcel-BUpgOtO1.js";import{D as U,E as L,z as B,r as K,o as P,d as V,a as S,s as X,p as J,b as i,c as v,q as D,w as n,g as a,l as b,e as H,v as O,x as $,F,M as j,A as Q,f,C as W,j as z,B as Y,_ as Z}from"./index-DHTjKAgc.js";import{l as ee}from"./subSystem-CEcU_uw-.js";function te(d){return U({url:"/system/admins/pageItem",method:"GET",params:d})}function ae(d){return U({url:"/system/admins/save",method:"POST",data:d})}function se(d){return U({url:"/system/admins/isExistUserName",method:"GET",params:d})}function ne(d){return U({url:"/system/admins/isExistUserId",method:"GET",params:d})}const le=L("subsysteManageStore",()=>{const d=B([]),r=K({current:1,size:10,subSystemType:"",startTime:"",endTime:""});P(()=>{_()});const _=async()=>{const m=await ee(r);d.value=m.records};return{SubData:d,model:r,SubMangerData:_}}),oe=V({__name:"AdministratorManageAdd",emits:["save"],setup(d,{expose:r,emit:_}){const m=S(!1),o=K({systemType:null,systemName:null,userId:"",userName:""}),y=le(),{SubData:N}=X(y),T=S(null),E={userId:[{required:!0,message:"请输入用户ID",trigger:"blur"},{validator:async(c,s)=>{if((await ne({userId:s})).data===!1)return Promise.reject("用户ID不存在")},trigger:"blur"}],userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:async(c,s)=>{if((await se({userName:s})).data===!1)return Promise.reject("用户名不存在")},trigger:"blur"}]},M=_;r({begin:()=>{var c;(c=T.value)==null||c.resetFields(),o.systemName=null,o.systemType=null,J(()=>{m.value=!0})},end:()=>{m.value=!1}});const C=()=>{j.confirm({title:"确定取消",content:"是否确定取消操作？",okText:"确定",cancelText:"取消",onOk:()=>{m.value=!1}})},q=async()=>{var c;await((c=T.value)==null?void 0:c.validate()),M("save",o)};return(c,s)=>{const x=i("a-select-option"),k=i("a-select"),g=i("a-form-item"),t=i("a-input"),e=i("a-form"),u=i("a-button"),w=i("a-modal");return v(),D(w,{open:m.value,"onUpdate:open":s[4]||(s[4]=l=>m.value=l),title:"管理员添加"},{footer:n(()=>[a(u,{onClick:C},{default:n(()=>s[5]||(s[5]=[b("取消")])),_:1}),a(u,{type:"primary",onClick:q},{default:n(()=>s[6]||(s[6]=[b("确定")])),_:1})]),default:n(()=>[a(e,{model:o,ref_key:"formRef",ref:T,rules:E},{default:n(()=>[a(g,{label:"系统类别"},{default:n(()=>[a(k,{value:o.systemType,"onUpdate:value":s[0]||(s[0]=l=>o.systemType=l),placeholder:"请选择系统类别"},{default:n(()=>[(v(!0),H(F,null,O($(N),l=>(v(),D(x,{key:l.id,label:l.ssType,value:l.ssType},null,8,["label","value"]))),128))]),_:1},8,["value"])]),_:1}),a(g,{label:"系统名称"},{default:n(()=>[a(k,{value:o.systemName,"onUpdate:value":s[1]||(s[1]=l=>o.systemName=l),placeholder:"请选择系统名称"},{default:n(()=>[(v(!0),H(F,null,O($(N),l=>(v(),D(x,{key:l.id,label:l.ssName,value:l.ssName},null,8,["label","value"]))),128))]),_:1},8,["value"])]),_:1}),a(g,{label:"用户ID",name:"userId"},{default:n(()=>[a(t,{value:o.userId,"onUpdate:value":s[2]||(s[2]=l=>o.userId=l),placeholder:"请输入用户ID"},null,8,["value"])]),_:1}),a(g,{label:"用户名",name:"userName"},{default:n(()=>[a(t,{value:o.userName,"onUpdate:value":s[3]||(s[3]=l=>o.userName=l),placeholder:"请输入用户名"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),re={class:"produce_admin_page"},ue={class:"table_form_view"},de={class:"table_action_view"},ie={class:"table_search_handler"},me={class:"table_action_button"},ce={class:"table_title"},pe={class:"table_title_icon"},_e=V({__name:"index",setup(d){const r=K({current:1,size:10,subSystemType:"",subSystemName:""}),_=B([]),m=B(0),o=S(null);P(()=>{y()});const y=async()=>{const t=await te(r);_.value=t.records,m.value||(m.value=t.total||0)},N=()=>{y()},T=()=>{r.subSystemName="",r.subSystemType="",y()},E=async t=>{var e;await ae(t),(e=o.value)==null||e.end(),y(),z.success("新增成功")},M=async t=>{j.confirm({title:"确定删除?",content:"此操作不可撤销，请确认是否删除该管理员的权限。",okText:"确认",cancelText:"取消",onOk:async()=>{z.success("删除成功")},onCancel(){z.error("操作已取消")}})},C=[{title:"序号",customRender:({text:t,record:e,index:u})=>`${u+1}`,align:"center"},{title:"系统名称",customRender:({text:t,record:e,index:u})=>`${e.subSystemName}`,dataIndex:"subSystemName",align:"center"},{title:"系统类别",customRender:({text:t,record:e,index:u})=>`${e.subSystemType}`,dataIndex:"subSystemType",align:"center"},{title:"用户ID",customRender:({text:t,record:e,index:u})=>`${e.userId}`,dataIndex:"userId",align:"center"},{title:"用户名",customRender:({text:t,record:e,index:u})=>`${e.userName}`,dataIndex:"userName",align:"center"},{title:"用户单位",customRender:({text:t,record:e,index:u})=>`${e.userCompany}`,dataIndex:"userCompany",align:"center"},{title:"用户权限",customRender:({text:t,record:e,index:u})=>`${e.role}`,dataIndex:"role",align:"center"},{title:"创建时间",customRender:({text:t,record:e,index:u})=>`${e.manageTime}`,dataIndex:"manageTime",align:"center"},{title:"操作",dataIndex:"action",align:"center"}],q=()=>{const t=["操作","序号"];return[...C.filter(e=>!t.includes(e.title))]},c=S([]),s=S([]),x=Q(()=>({selectedRowKeys:c.value,onChange:(t,e)=>{c.value=t,s.value=e}})),k=()=>{h(s.value.map((t,e)=>({...t,sn:e})),q(),"selectedData.xlsx")},g=t=>{r.current=t.current,r.size=t.pageSize,y()};return(t,e)=>{const u=i("a-input"),w=i("a-form-item"),l=i("a-form"),I=i("a-button"),A=i("a-table");return v(),H("div",re,[f("div",ue,[a(l,{class:"search_form",layout:"inline",autocomplete:"off"},{default:n(()=>[a(w,{label:"系统类别"},{default:n(()=>[a(u,{placeholder:"请输入",value:r.subSystemType,"onUpdate:value":e[0]||(e[0]=p=>r.subSystemType=p)},null,8,["value"])]),_:1}),a(w,{label:"子系统名"},{default:n(()=>[a(u,{placeholder:"请输入",value:r.subSystemName,"onUpdate:value":e[1]||(e[1]=p=>r.subSystemName=p)},null,8,["value"])]),_:1})]),_:1}),f("div",de,[f("div",ie,[a(I,{class:"table_search_button",type:"primary",onClick:e[2]||(e[2]=p=>N())},{default:n(()=>e[4]||(e[4]=[b("查询")])),_:1}),a(I,{class:"table_search_clean_button",type:"primary",onClick:T},{default:n(()=>e[5]||(e[5]=[b("清除")])),_:1}),a(I,{class:"table_search_button",type:"primary",onClick:k},{default:n(()=>e[6]||(e[6]=[b("导出信息")])),_:1})]),f("div",me,[a(I,{class:"table_action_add",type:"primary",onClick:e[3]||(e[3]=p=>{var R;return(R=o.value)==null?void 0:R.begin()})},{default:n(()=>e[7]||(e[7]=[b(" 增加管理员 ")])),_:1})])])]),f("div",ce,[f("div",pe,[a($(W))]),e[8]||(e[8]=f("div",{class:"table_title_text"},"菜单名称",-1))]),a(A,{columns:C,"data-source":_.value,pagination:$(G)(m.value),"row-selection":x.value,rowKey:p=>p.id,onChange:g},{bodyCell:n(({column:p,record:R})=>[p.dataIndex==="action"?(v(),D(I,{key:0,class:"no-border-button",type:"primary",ghost:"",danger:"",onClick:ye=>M(R.n3)},{default:n(()=>e[9]||(e[9]=[b("删除")])),_:2},1032,["onClick"])):Y("",!0)]),_:1},8,["data-source","pagination","row-selection","rowKey"]),a(oe,{ref_key:"addRef",ref:o,onSave:E,tableData:_.value},null,8,["tableData"])])}}}),xe=Z(_e,[["__scopeId","data-v-605f2232"]]);export{xe as default};
