import{u as F,e as L}from"./exportToExcel-BUpgOtO1.js";import{D as H,d as h,a as k,r as z,p as P,b as l,c as x,q as O,w as n,g as a,l as m,e as K,v as j,t as G,F as X,M as U,z as S,o as J,A as Q,f,x as $,C as W,j as w,B as Y,_ as Z}from"./index-DHTjKAgc.js";function ee(r){return H({url:"/market/users/pageItem",method:"GET",params:r})}function te(r){return H({url:"/market/users/save",method:"POST",data:r})}function ae(r){return H({url:"/market/users/deleteBatchByIds",method:"DELETE",params:r})}const ne=h({__name:"MarketUserManageUserAdd",props:{tableData:Array},emits:["save"],setup(r,{expose:s,emit:v}){const c=k(!1),d=z({marketId:null,userId:""}),_=k(null),i=r,D=v;s({begin:()=>{var u;(u=_.value)==null||u.resetFields(),P(()=>c.value=!0)},end:()=>{c.value=!1}});const N=()=>{U.confirm({title:"确定取消",content:"是否确定取消操作？",okText:"确定",cancelText:"取消",onOk:()=>{c.value=!1}})},T=async()=>{var u;await((u=_.value)==null?void 0:u.validate()),D("save",d)};return(u,o)=>{const R=l("a-select-option"),g=l("a-select"),b=l("a-form-item"),B=l("a-input"),E=l("a-form"),C=l("a-button"),t=l("a-modal");return x(),O(t,{open:c.value,"onUpdate:open":o[2]||(o[2]=e=>c.value=e),title:"增加管理员权限"},{footer:n(()=>[a(C,{onClick:N},{default:n(()=>o[3]||(o[3]=[m("取消")])),_:1}),a(C,{type:"primary",onClick:T},{default:n(()=>o[4]||(o[4]=[m("确定")])),_:1})]),default:n(()=>[a(E,{model:d,ref_key:"formRef",ref:_},{default:n(()=>[a(b,{label:"选择市场"},{default:n(()=>[a(g,{value:d.marketId,"onUpdate:value":o[0]||(o[0]=e=>d.marketId=e),placeholder:"请选择市场"},{default:n(()=>[(x(!0),K(X,null,j(i.tableData,e=>(x(),O(R,{key:e.id,value:e.marketId,label:e.marketName},{default:n(()=>[m(G(e.marketName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"])]),_:1}),a(b,{label:"管理员"},{default:n(()=>[a(B,{value:d.userId,"onUpdate:value":o[1]||(o[1]=e=>d.userId=e),placeholder:"请输入用户ID"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),oe={class:"product_market_page"},le={class:"table_form_view"},se={class:"table_action_view"},re={class:"table_search_handler"},ce={class:"table_action_button"},de={class:"table_title"},ie={class:"table_title_icon"},ue=h({__name:"index",setup(r){const s=z({current:1,size:10,marketName:""}),v=S([]),c=S(0),d=k(null),_=k(null);J(async()=>{i()});const i=async()=>{const t=await ee(s);v.value=t.records,c.value||(c.value=t.total||0)},D=async()=>{i()},N=()=>{s.marketName="",i()},T=async t=>{var e;await te(t),(e=_.value)==null||e.end(),i(),w.success("新增成功")},u=async t=>{U.confirm({title:"确定删除?",content:`此操作不可撤销，请确认是否删除${t.userName}的权限`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await ae({ids:t.userId}),i(),w.success("删除成功")}catch{w.error("删除失败，请稍后重试")}},onCancel(){w.warning("此操作已取消")}})},o=[{title:"序号",customRender:({text:t,record:e,index:M})=>`${M+1}`,align:"center"},{title:"市场名",dataIndex:"marketName",align:"center"},{title:"用户ID",dataIndex:"userId",align:"center"},{title:"用户名",dataIndex:"userName",align:"center"},{title:"用户单位",dataIndex:"userCompany",align:"center"},{title:"用户组织",dataIndex:"userOrganization",align:"center"},{title:"操作",dataIndex:"action",align:"center"}],R=()=>{const t=["操作","序号"];return[...o.filter(e=>!t.includes(e.title))]},g=k([]),b=k([]),B=Q(()=>({selectedRowKeys:g.value,onChange:(t,e)=>{g.value=t,b.value=e}})),E=()=>{U.confirm({title:"确定导出选中数据吗？",content:"导出后无法修改，请确认是否导出？",okText:"确定",cancelText:"取消",onOk:()=>{L(b.value.map((t,e)=>({...t,sn:e})),R(),"selectedData.xlsx")}})},C=t=>{s.current=t.current,s.size=t.pageSize,i()};return(t,e)=>{const M=l("a-input"),A=l("a-form-item"),V=l("a-form"),y=l("a-button"),q=l("a-table");return x(),K("div",oe,[f("div",le,[a(V,{class:"search_form",ref_key:"formRef",ref:d,model:s,layout:"inline",autocomplete:"off"},{default:n(()=>[a(A,{label:"市场名"},{default:n(()=>[a(M,{value:s.marketName,"onUpdate:value":e[0]||(e[0]=p=>s.marketName=p),placeholder:"请输入市场名"},null,8,["value"])]),_:1})]),_:1},8,["model"]),f("div",se,[f("div",re,[a(y,{class:"table_search_button",type:"primary",onClick:e[1]||(e[1]=p=>D())},{default:n(()=>e[3]||(e[3]=[m("查询")])),_:1}),a(y,{class:"table_search_clean_button",type:"primary",onClick:N},{default:n(()=>e[4]||(e[4]=[m("清除")])),_:1}),a(y,{class:"table_search_button",type:"primary",onClick:E},{default:n(()=>e[5]||(e[5]=[m("导出信息")])),_:1})]),f("div",ce,[a(y,{class:"table_action_add",type:"primary",onClick:e[2]||(e[2]=p=>{var I;return(I=_.value)==null?void 0:I.begin()})},{default:n(()=>e[6]||(e[6]=[m(" 增加管理员 ")])),_:1})])])]),f("div",de,[f("div",ie,[a($(W))]),e[7]||(e[7]=f("div",{class:"table_title_text"},"菜单名称",-1))]),a(q,{columns:o,"data-source":v.value,pagination:$(F)(v.value.length),"row-selection":B.value,rowKey:p=>p.id,onChange:C},{bodyCell:n(({column:p,record:I})=>[p.dataIndex==="action"?(x(),O(y,{key:0,class:"no-border-button",type:"primary",ghost:"",onClick:me=>u(I)},{default:n(()=>e[8]||(e[8]=[m(" 删除 ")])),_:2},1032,["onClick"])):Y("",!0)]),_:1},8,["data-source","pagination","row-selection","rowKey"]),a(ne,{ref_key:"addRef",ref:_,onSave:T,tableData:v.value},null,8,["tableData"])])}}}),fe=Z(ue,[["__scopeId","data-v-0d3300cb"]]);export{fe as default};
